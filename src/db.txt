CREATE TABLE users (
	user_id int PRIMARY KEY AUTO_INCREMENT,
    username varchar(255) NOT NULL,
 	upassword varchar(255) NOT null,
    age int(3),
    max_score int(2) DEFAULT 0
);

CREATE TABLE quiz (
	quiz_id int PRIMARY KEY AUTO_INCREMENT,
    quiz_topic varchar(255) NOT null,
    time_to_question int NOT null,
    creator_id int NOT null,
    FOREIGN KEY (creator_id) REFERENCES users(user_id)
);

CREATE TABLE questions (
	ques_id int PRIMARY KEY AUTO_INCREMENT,
    ques_text varchar(255) NOT null,
    answer int(2) NOT null,
    quiz_id int NOT null,
    FOREIGN KEY (quiz_id) REFERENCES quiz(quiz_id)
);

CREATE TABLE answers (
	ans_id int AUTO_INCREMENT PRIMARY KEY,
    ans_text varchar(255) NOT null,
    ques_id int NOT null,
    FOREIGN KEY (ques_id) REFERENCES questions(ques_id)
);

CREATE TABLE high_scores (
	hscore_id int PRIMARY KEY AUTO_INCREMENT,
    score int NOT null,
    user_id int NOT null,
    quiz_id int NOT null,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    FOREIGN KEY (quiz_id) REFERENCES quiz(quiz_id)
);

SELECT quiz.*, users.username FROM quiz
INNER JOIN users ON users.user_id = quiz.creator_id;

SELECT * FROM high_scores WHERE user_id=? GROUP BY quiz_id ORDER BY score DESC
--optional LIMIT 5

SELECT *, MAX(score) FROM high_scores WHERE user_id=? GROUP BY quiz_id

SELECT a.* FROM high_scores a INNER JOIN (select * from high_scores group by hscore_id ORDER BY score DESC) b ON a.hscore_id = b.hscore_id GROUP BY quiz_id

SELECT a.*, users.username FROM high_scores a INNER JOIN (select * from high_scores group by hscore_id ORDER BY score DESC) b ON a.hscore_id = b.hscore_id
INNER JOIN users ON users.user_id = a.user_id
GROUP BY quiz_id
